
###########################################################
##- name: Get secrets in namespace
##  kubernetes.core.k8s_info:
##    api_version: v1
##    kind: Secret
##    namespace: "{{ pipeline_namespace }}"
##  register: secrets_info
##
##- name: Debug secrets_info variable
##  debug:
##    var: secrets_info
##
##- name: Extract secret name using regex
##  set_fact:
##    secret_name: "{{ secrets_info.resources | map(attribute='metadata.name') | select('match', regex) | list | first }}"
##  vars:
##    regex: ".*pipeline.*"
##
##- name: Display secret name
##  debug:
##    var: secret_name
##
##- name: Get token in the secret for the sa pipeline and decode
##  kubernetes.core.k8s_info:
##    kind: Secret
##    api_version: /v1
##    name: "{{ secret_name }}"
##    namespace: "{{ pipeline_namespace }}"
##  register: r_token_sa_secret
##
##- debug:
##    msg: "{{ r_token_sa_secret.resources[0].data.token | b64decode }}"
##
##- name: define the token secret decoded
##  set_fact:
##    pipeline_token: "{{ r_token_sa_secret.resources[0].data.token | b64decode }}"
###########################################################
#- name: Creating ACS Integration with the Openshift Internal Registry
#  uri:
#    url: "https://{{ f_stackrox_central_addr }}/v1/imageintegrations"
#    body: "{{ lookup('template', 'templates/ocp_registry_acs.yml.j2') }}"
#    method: POST
#    user: admin
#    password: "{{ acs_central_password }}"
#    body_format: json
#    force_basic_auth: true
#    validate_certs: no
#    # temporarily accept 400s due to ROX-6699
#    status_code: 200, 400
